---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---
<br>
<br>
**Abréviations**
<br>da = disponibilité alimentaire
<br>di = disponibilité intérieur
<br>e = énergie
<br>p = protéine
<br>pds = poids
<br>n = nourriture
<br>aa = aliment pour animaux
<br>pe = perte
<br>t = totale
<br>pop = population
<br>sa = sous alimenté

**library**
```{r 2013 library, message=FALSE, warning=FALSE}
### On charge les library utile à notre projet
library(dplyr)
library(DT)
options("scipen"=100)
```

**Fonctions** 
```{r 2013 fonctions, message=FALSE, warning=FALSE}
### table_faop prend 5 arguments fixent en entré
### -table1 et la table de la FAO principale
### -table2 est la table de la FAO secondaire
### -code.élément, élément, unité, permettent de changer les colonnes du
### même nom dans la table1.
### -On peut multiplier le résultat du produit effectué par l'argument
### coefficient.
### ... sont le nom des colonnes par lesquels nous voulons effectuer la
### jointure interne.
###
### table_faop permet de creer une nouvelle table FAO à partir de deux 
### table FAO qui aura pour valeurs les produits des valeurs des 2 
### tables choisies.
table_faop <- 
  function(table1, table2, ..., code.élément = NA,
           élément = NA, unité = NA,
           coefficient = 1){
    ### On effectue une jointure interne (pas de NA dans les valeurs)
    ### entre table1 et la colonne Valeur de table2 par ...)
    new_table<-inner_join(table1,select(table2, ..., Valeur),
                          by = c(...))%>%
    ### On change les valeurs des colonnes que l'on souhaite
    mutate(Code.Élément = code.élément,
           Élément = élément,
           Unité = unité,
           ### On effectue le produit entre les valeurs de colonnes
           ### puis on multiplie le résultat par coefficient
           Valeur = round(Valeur.x*Valeur.y*coefficient,0))%>%
    ### On supprime les colonne valeur de table1 et table2
    select(c(1:11,16,13:14))
  ### On renvoie la nouvelle table
  return(new_table)
  }

### Cette fonction fait la même chose que table_faop mais permet de
### diviser les valeurs des colonnes au lieu de les multiplier.
table_faor <- 
  function(table1, table2, ..., code.élément = NA,
           élément = NA, unité = NA,
           coefficient = 1){ 
    new_table<-inner_join(table1,select(table2, ..., Valeur),
                          by = c(...))%>%
    mutate(Code.Élément = code.élément,
           Élément = élément,
           Unité = unité,
           Valeur = round((Valeur.x/Valeur.y)*coefficient,0))%>%
    select(c(1:11,16,13:14))
  return(new_table)
  }

### iscereal pend un argument en entré:
### -la table à laquelle on va ajouter une colonne is_cereal
### ayant pour valeur TRUE or FALSE
iscereal<-
  function(table){
    ###On extrait la table avec seulement les céréales 
    x<-filter(table, Code.Produit %in% c(2511:2520, 2805))
    ###On ajoute une colonne is_cereal avec pour valeur TRUE
    x$is_cereal<- TRUE
    ###On extrait la table avec seulement ce qui n'est pas céréale
    y<-filter(table, !(Code.Produit %in% c(2511:2520, 2805)))
    ###On ajoute une colonne is_cereal avec pour valeur False
    y$is_cereal<- FALSE
    ###On colle nos deux tables
    table<-rbind(y, x)
    ###On renvoie la nouvelle table
    return(table)
  }  
```
**Data.frames pour 2013 :**
```{r 2013 data.frames, message=FALSE, warning=FALSE}
###On charge toutes les tables de la FAO que l'on a récupéré:
###-On charge le tableau des population par pays en 2013
pop2013<-read.csv("pop2013.csv", encoding = "UTF-8")
###-On charge le tableau des produits végétaux de 2013
###(On filtre les agrégats pour ne pas compter deux fois)
veg2013<-read.csv("veg2013.csv", encoding = "UTF-8")%>%
  filter(Symbole != "A")
###-On charge le tableau des produits animaux de 2013
###(On filtre les agrégats pour ne pas compter deux fois)
animal2013<-read.csv("animal2013.csv", encoding = "UTF-8")%>%
  filter(Symbole != "A")
###-On charge le tableau de production des céréales de 2013
cereal2013<-read.csv("cereal2013.csv", encoding = "UTF-8")
###On crée la table de tout les produits 
###(en assemblant celle des produits végétaux et  
###celle des produitsanimaux)
produit2013<-rbind(veg2013, animal2013)
```
**Data.frames pour 2017 :**
```{r 2017 data.frames, message=FALSE, warning=FALSE}
###-On charge le tableau des population par pays en 2017
pop2017<-read.csv("pop2017.csv", encoding = "UTF-8")
###-On charge le tableau des produits végétaux de 2017
###(On filtre les agrégats pour ne pas compter deux fois)
veg2017<-read.csv("veg2017.csv", encoding = "UTF-8")%>%
  filter(Symbole != "A")
###-On charge le tableau des produits animaux de 2017
###(On filtre les agrégats pour ne pas compter deux fois)
animal2017<-read.csv("animal2017.csv", encoding = "UTF-8")%>%
  filter(Symbole != "A")
###-On charge le tableau de production des céréales de 2017
cereal2017<-read.csv("cereal2017.csv", encoding = "UTF-8")
###On crée la table de tout les produits 
###(en assemblant celle des produits végétaux et  
###celle des produitsanimaux)
produit2017<-rbind(veg2017, animal2017)
```
**Data.frames global :**
```{r data.frames, message=FALSE, warning=FALSE}
###-On charge le tableau du nombre de personne sous-alimenté
###par pays(On enlève la chine pour ne compter personne en double)
sousali<-read.csv("sousali.csv", encoding = "UTF-8")%>%
  filter(Code.zone != "351")
```
<br>
<br>
**Question 1:**

Pour l'année 2013:
```{r 1}
###On calcul la somme de toute les populations
###Unité : 1000personnes
###On multiplie par mille pour être en personne
sum(pop2013$Valeur)*1000
```
Le résultat est beaucoup trop grand il devrait tourner autour de 7 milliard.
```{r 1 2013}
###On enlève les agrégats, ce qui empêche des populations
###d'être compté deux fois
pop2013<-filter(pop2013, Symbole != "A")
###On recalcul la somme de toute les populations
pop2013_t<-sum(pop2013$Valeur)*1000
###On écrit la réponse à la question
cat("le nombre d'humain en 2013 est", pop2013_t)
```
Pour l'année 2017:
```{r 1 2017}
pop2017<-filter(pop2017, Symbole != "A")

pop2017_t<-sum(pop2017$Valeur)*1000

cat("le nombre d'humain en 2017 est", pop2017_t)
```
```{r}
augmentation_pop_année<-((pop2017_t - pop2013_t)/4)/pop2013_t
pop2050_t_estimé<-pop2017_t*(1 + augmentation_pop_année)^33

cat("Si la population augmente de façon linéaire on peut estimer",
"\nqu'il y aura",round(pop2050_t_estimé, -6)/10^9,"milliards d'être", "humain sur la planète en 2050. La plupart des estimations prévoit",
"une diminution de l'augmentation et estime que l'on sera",
"\nplutôt 9.7 milliards")
```
**Question 2:**

L’équation qui relie les 11 quantités données est :

\begin{align}
Disponibilit\acute{e}\,int\acute{e}rieur 
&= production + importation - exportation - variation\,de\,stock\\ 
&= nourriture + pertes + semances + aliments\, pour\,animaux + traitement + autres\,utilisations
\end{align}
<br>
*Exemple:*

Les valeurs des 11 quantitées pour le blé en France en 2017

```{r 2 2013 exemple, message=FALSE}
###On charge les 11 quantitées du blé en france en 2017
ble<-read.csv("ble_fr_2017.csv", encoding = "UTF-8")%>%
  select("Élément","Valeur" )
###On affiche le résultat
datatable(ble)
###disponibilité intérieur
ble$Valeur[5]
###nourriture + pertes + semances + aliments pour animaux +
###traitement + autres utilisations
sum(ble$Valeur[6:11])
###production + importation - (exportation + variation de stock)
sum(ble$Valeur[1:2])-sum(ble$Valeur[3:4])
```
On considère l’équation vérifiée (nous sommes dans le monde réel il y a des approximations)
<br>
<br>
*Pour l'année 2013*
<br>
<br>
**Question 3** 
```{r 3 2013 da, message=FALSE, warning=FALSE}
da2013_e<-
  ###On ne garde que la disponibilité alimetaire en kcal en 2013
  ###(en filtrant par le code élément 664)
  filter(produit2013, Code.Élément == 664)%>%
  ### On multiplie les calories de chaque produit pour chaque pays par 
  ### la population de chaque pays pour obtenir les calories du produit
  ### dans chacun des pays
  ### Unité : (kcal/personne/jour)*1000personne = 1000kcal/jour
  ### On multiplie le résultat par 1/1000 et on est en 10^6kcal 
  table_faop(pop2013,
             élément = "Disponibilité alimentaire totale",
             unité = "10^6 Kcal/jour", "Zone", coefficient =  1/1000)

datatable(select(da2013_e,4,6,8,10:12))

# On fait pareil pour les protéines
# Unité : (g/personne/jour)*1000personne = kg/jour
# On multiplie le résultat par 1/1000 et on est en tonne/jour
da2013_p<-
  ###On ne garde que la disponibilité alimetaire en g en 2013
  ###(en filtrant par le code élément 674)
  filter(produit2013, Code.Élément == 674)%>%
  table_faop(pop2013,
             élément = "Disponibilité totale de protéines",
             unité = "tonne/jour", "Zone", coefficient =  1/1000)
                     
datatable(select(da2013_p,4,6,8,10:12))
```
<br>
<br>
**Question 4**

```{r 4 2013 ratios, message=FALSE, warning=FALSE}
### On divise l'énergie de chaque produit par pays par leur poid
### par pays pour obtenir le ratio énergie/poid de chacun.
### Unité : (10^6kcal/jour)/(1000tonnes/an) = 365kcal/kg
### On multiplie le résultat par 365 et on est en kcal/kg
ratio_e_pds<-
  ###On ne garde que la nourriture pour la consomation
  ###humaine en 2013 (en filtrant par le code élément 5142, on filtre
  ### aussi les valeurs nuls et négatives pour plus de précision)
  filter(produit2013, Code.Élément == 5142)%>%
  filter(Valeur >=1)%>%
  table_faor(
    ### On filtre les 0 pour gagner en précision
    filter(da2013_e, Valeur >=1),
    ., élément = "ratio (énergie/poids)",
    unité = "kcal/kg", "Zone",
    "Produit", coefficient = 365)

datatable(select(ratio_e_pds,4,6,8,10:12))

### On divise le poid de protéine de chaque produit par pays par leur ### poid par pays pour obtenir le ratio poid protéine/poid de chacun.
### Unité : (tonne/jour)/(1000tonnes/an) = 365/1000 
### On multiplie le résultat par 36,5 et on est en pourcentage
ratio_p_pds<-
  filter(produit2013, Code.Élément == 5142)%>%
  filter(Valeur >=1, Symbole != "A")%>%
  table_faor(
    da2013_p,
    ., élément = "(poids de protéines/poids total)*100",
    unité = "pourcentage", "Zone",
    "Produit", coefficient = 36.5)

datatable(select(ratio_p_pds,4,6,8,10:12))
```
<br>
<br>
**Question 5**

```{r 5 2013 moyenne_ratio, message=FALSE, warning=FALSE}
### On calcul la moyenne des ratio à l'aide d'une agrégation
moyenne_ratio_e_pds<-ratio_e_pds %>% 
  group_by(Produit) %>% 
  summarise(Valeur=round(mean(Valeur),0))

datatable(moyenne_ratio_e_pds)


moyenne_ratio_p_pds<-ratio_p_pds %>% 
  group_by(Produit) %>% 
  summarise(Valeur=round(mean(Valeur),0))

datatable(moyenne_ratio_p_pds)
```
<br>
<br>
**Question 6**
```{r 6 2013 di_veg, message=FALSE, warning=FALSE}
###On calcul la disponibilité intérieur mondiale par produit
di2013_veg<-
  ###On filtre la disponibilité intérieur
  filter(veg2013, Code.Élément == 5301)%>%
  ###On somme par produit
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

### On calcul la somme totale de calorie végétale du monde pour un an

### On multiplie le poid de chaque produit par leur ratio(énergie/poid)
### puis on fait la somme de tous les produits.
### Unité : (1000tonnes/an)*(kcal/kg) = 10^6kcal/an
### On multiplie le résultat par 10^6 et on est en kcal/an
somme_di2013_veg_e<-
  inner_join(di2013_veg, moyenne_ratio_e_pds, by = "Produit")%>%
  transmute(Valeur = Valeur.x*Valeur.y*10^6)%>%
  .$Valeur%>%
  sum()

cat("la disponibilité intérieure mondiale exprimée en kcal uniquement",
    "pour les produits végétaux est de",somme_di2013_veg_e,"kcal")
```
<br>
<br>
**Question 7**
```{r 7 2013 humain nourrit, message=FALSE, warning=FALSE}

cat("si toute la disponibilité intérieure mondiale de produits",
    "végétaux était utilisée \npour de la nourriture en 2013",
    "cela représenterai",somme_di2013_veg_e,"kcal") 

### On calcul la somme totale de protéine végétale du monde pour un an

### On multiplie le poid de chaque produit par leur pourcentage de 
### protéine puis on fait la somme de tous les produits.
### Unité : (1000tonnes/an)*(1/100) = 10^4kg/an
### On multiplie le résultat par 10^4 et on est en kg
somme_di2013_veg_p<-
  inner_join(di2013_veg, moyenne_ratio_p_pds, by = "Produit")%>%
  transmute(Valeur = Valeur.x*Valeur.y*10^4)%>%
  .$Valeur%>%
  sum()

cat("si toute la disponibilité intérieure mondiale de produits",
    "végétaux était utilisée \npour de la nourriture en 2013",
    "cela représenterai",somme_di2013_veg_p,"kg de protéine")  

### Un humain à besoin de 2300 kcal par jour pour survivre (FAO)
cal_min_per_jour<-2300
### Un humain à besoin de 0.05 kg de protéine par jour pour survivre
proteine_min_per_jour<-0.05

### On calcule le pourcentage de population mondiale que l'on peut
### nourir en terme de calorie avec seulement les produits végétaux
### Unité : (kcal/ans)/(personnes*(kcal/jour/personne)) = 1/365
### On multiplie par 365 puis par 100 et on est en pourcentage
humain1_nourrit_e<-
  (somme_di2013_veg_e/(365*pop2013_t*cal_min_per_jour))*100

cat("si toute la disponibilité intérieure mondiale de produits",
    "végétaux était utilisée \npour de la nourriture on pourrait",
    "nourir",humain1_nourrit_e,"% de la population mondiale",
    "\nen terme de calories")

### On calcule le pourcentage de population mondiale que l'on peut
### nourir en terme de protéine avec seulement les produits végétaux
### Unité : (kg/ans)/(personnes*(kg/jour/personne)) = 1/365
### On multiplie par 365 puis par 100 et on est en pourcentage
humain1_nourrit_p<-
  (somme_di2013_veg_p/
  (365*pop2013_t*proteine_min_per_jour))*100

cat("si toute la disponibilité intérieure mondiale de produits",
    "végétaux était utilisée \npour de la nourriture on pourrait",
    "nourir",humain1_nourrit_p,"% de la population mondiale",
    "\nen terme de protéines")
```
<br>
<br>
**Question 8**
```{r 8 2013 somme_n_pe_aa_veg, message=FALSE, warning=FALSE}
n_pe_aa_veg2013_e<-
  ###On ne garde que nourriture, perte et aliment pour animaux en 2013
  ###(en filtrant par les codes élément 5142, 5123 et 5521)
  filter(veg2013, Code.Élément %in% c(5142, 5123, 5521))%>%
  ###On somme par produit et zone
  group_by(Produit, Zone)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###On multiplie chaque produit de chaque pays par son ratio
  ###Unité = 1000t*kcal/kg = 10^6kcal
  ###On multiplie par 10^6 pour être en kcal
  table_faop(ratio_e_pds, ., "Produit","Zone", coefficient = 10^6)%>%
  ###On somme tous les kcal de chaques produits de chaques pays
  select(Valeur)%>%
  sum()

cat("En 2013 si toute la disponibilité alimentaire en produits",
    "végétaux la nourriture végétale \ndestinée aux animaux et les",
    "pertes de produits végétaux étaient utilisés pour de la", 
    "nourriture \ncela représenterai",n_pe_aa_veg2013_e,
    "kcal de nourriture")

n_pe_aa_veg2013_p<-
  filter(veg2013, Code.Élément %in% c(5142, 5123, 5521))%>%
  group_by(Produit, Zone)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###Unité = 1000t*1/100 = 10t =10000kg
  ###On multiplie par 10000 pour être en kg
  table_faop(ratio_p_pds, ., "Produit","Zone", coefficient = 10^4)%>%
  select(Valeur)%>%
  sum()

cat("En 2013 si toute la disponibilité alimentaire en produits",
    "végétaux la nourriture végétale \ndestinée aux animaux et les",
    "pertes de produits végétaux étaient utilisés pour de la", 
    "nourriture \ncela représenterai",n_pe_aa_veg2013_p,
    "kg de protéine")

humain2_nourrit_e<-
  ###On divise le totale de kcal des produits végétaux 
  ###(nourriture, aliment pour animaux et perte)
  ###par le besoin mondiale en kcal pour un an
  ###On multiplie par cent pour obtenir un pourcentage
  (n_pe_aa_veg2013_e/(365*pop2013_t*cal_min_per_jour))*100

cat("En 2013 si toute la disponibilité alimentaire en produits",
    "végétaux la nourriture végétale \ndestinée aux animaux et les",
    "pertes de produits végétaux étaient utilisés pour de la", 
    "nourriture \non pourrait nourrir",humain2_nourrit_e,
    "% de la population mondiale en terme de calories")

humain2_nourrit_p<-
  ###On divise le totale de g de protéine des produits végétaux 
  ###(nourriture, aliment pour animaux et perte)
  ###par le besoin mondiale en protéine pour un an
  ###On multiplie par cent pour obtenir un pourcentage
  (n_pe_aa_veg2013_p/(365*pop2013_t*proteine_min_per_jour))*100

cat("En 2013 si toute la disponibilité alimentaire en produits",
    "végétaux la nourriture végétale \ndestinée aux animaux et les",
    "pertes de produits végétaux étaient utilisés pour de la", 
    "nourriture \non pourrait nourrir",humain2_nourrit_p,
    "% de la population mondiale en terme de protéine")
```
<br>
<br>
**Question 9**
```{r 9 2013 somme_da, message=FALSE, warning=FALSE}
###On calcul la somme des disponibilitées alimentaire de chaque
###pays en kcal

somme_da2013_e<-
  ###On ne garde que la nourriture en 2013
  ###(en filtrant par le codes élément 5142)
  filter(produit2013, Code.Élément == 5142)%>%
  ###On somme par produit et zone
  group_by(Produit, Zone)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###On multiplie chaque produit de chaque pays par son ratio
  ###Unité = 1000t*kcal/kg = 10^6kcal
  ###On multiplie par 10^6 pour être en kcal
  table_faop(ratio_e_pds, ., "Produit","Zone", coefficient = 10^6)%>%
  ###On somme tous les kcal de chaques produits de chaques pays
  select(Valeur)%>%
  sum()

cat("En 2013 la disponibilité alimentaire mondiale en terme de", 
    "\ncalories est de",somme_da2013_e,"kcal")
    
somme_da2013_p<-
  filter(produit2013, Code.Élément == 5142)%>%
  group_by(Produit, Zone)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###Unité = 1000t*1/100 = 10t =10000kg
  ###On multiplie par 10000 pour être en kg
  table_faop(ratio_p_pds, ., "Produit","Zone", coefficient = 10^4)%>%
  select(Valeur)%>%
  sum()

cat("En 2013 la disponibilité alimentaire mondiale en terme de", 
    "\nprotéine est de",somme_da2013_e,"kg")

humain3_nourrit_e<-
  (somme_da2013_e/(365*pop2013_t*cal_min_per_jour))*100

cat(humain3_nourrit_e,"% de la population mondiale pourraient être", 
    "nourris avec la \ndisponibilité alimentaire mondiale en",
    "terme de calories en 2013")

humain3_nourrit_p<-
  (somme_da2013_p/(365*pop2013_t*proteine_min_per_jour))*100

cat(humain3_nourrit_p,"% de la population mondiale pourraient être", 
    "nourris avec la \ndisponibilité alimentaire mondiale en",
    "terme de protéines en 2013")
```
<br>
<br>
**Question 10**
```{r 10 2013 sous alimentées, message=FALSE, warning=FALSE}
nbre_sa2013 <-
  ###On filtre les personne sous alimenté par pays en 2013 
  ###on filtre les pays dont on ne connait
  ###pas les chiffre et les pays qui compte moins de 
  ###100000 personnes sous alimenté)
  filter(sousali, Symbole == "F",
         Valeur != "<0.1",
         Code.année == 20122014)%>%
  ###On sélectionne la colonne "Valeur"
  select(Valeur)%>%
  ###On la transforme en vecteur numerique pour 
  ###pouvoir sommer ses éléments
  unlist()%>%
  as.vector()%>%
  as.numeric()%>%
  ###On somme toutes les valeurs pour obtenir le totale de personne
  ### sous alimenté
  sum()*10^6
  
cat((nbre_sa2013/pop2013_t)*100,
"% de la population mondiale est considérée",
"comme étant en sous-nutrition en 2013 d'après la FAO")  
```
<br>
<br>
**Question 11**
<br>
<br>
```{r 11 2013 cereal, message=FALSE, warning=FALSE}
###On ajoute une colonne is_cereal à la table produit2013
produit2013<-iscereal(produit2013)

###On affiche les différents produit de type céréale
filter(produit2013, is_cereal == TRUE)%>%
  group_by(Code.Produit, Produit)%>%
  summarise()%>%
  datatable()

###On calcul le poid totale des céréales pour la consomation
###humaine et animale
cereal2013_n_aa <-
  ###On filtre les éléments nourriture et aliment
  ###pour animaux et on filtre les produits de type céréale
  filter(produit2013, Code.Élément %in% c(5142, 5521),
         is_cereal == TRUE)%>%
  ###On somme le tout
  select(Valeur)%>%
  sum()

###On calcul le poids des céréales pour animaux              
cereal2013_aa <- 
  filter(produit2013, Code.Élément == 5521,
         is_cereal == TRUE)%>%
  select(Valeur)%>%
  sum()

###On fait le quotient aa/(n + aa) et on affiche la réponse
###On multiplie par cent pour être en pourcentage
cat(cereal2013_aa*100/cereal2013_n_aa,"% des céréales destinées à",
    "l'alimentation est réservé aux animaux")
```
<br>
<br>
**Question 12**
```{r 12 2013 sous nutrition, message=FALSE, warning=FALSE}
###On veut sélectionner les 15 produits les plus exportés
###par les pays possédant des personnes en sous-nutrition
prdt_sa2013<-
  ###On filtre les pays dans lesquels la FAO recense des   
  ###personnes en sous-nutrition en 2013
  filter(sousali, Symbole == "F", Code.année == 20122014)%>%
  select(Zone)%>%
  ###On joint avec les exportations en 2013
  inner_join(filter(produit2013, Code.Élément == 5911))%>%
  ###On somme par produit
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###On range du produit le plus exporté au moins exporté
  arrange(desc(Valeur))%>%
  ###On conserve les 15 premiers
  slice(1:15)%>%
  ###On ne garde que la colonnes produit
  select(Produit)

###La liste des 15 produits les plus exportés par les pays possédant
###des personnes en sous-nutrition en 2013 (prdt_sa2013)
datatable(prdt_sa2013)

###Somme des 200 importations les plus importantes de la liste des
###15 produits ci-dessus par produit
importation_prdt_sa2013<-
  ###On filtre les importations en 2013 
  filter(produit2013, Code.Élément == 5611)%>%
  ###On joint avec les 15 produit ci-dessus
  inner_join(prdt_sa2013)%>%
  ###On range de la plus grande à la moins grande
  arrange(desc(Valeur))%>%
  ###On ne garde que les 200 plus grandes importations
  slice(1:200)%>%
  ###On somme par produit
  group_by(Produit, Unité)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###On range dans l'ordre décroissant
  arrange(desc(Valeur))

datatable(importation_prdt_sa2013)

###On calcul le poids des autres utilisations des produits de la liste
autre_prdt_sa2013<-
  ###On filtre les autres utilisations
  filter(produit2013, Code.Élément == 5154)%>%
  ###On joint à la liste
  inner_join(prdt_sa2013)%>%
  ###On somme par produit
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

###On calcul la disponibilité intérieur des 15 produits de la liste
di_prdt_sa2013<-
  ###On filtre la disponibilité intérieur
  filter(produit2013, Code.Élément == 5301)%>%
  ###On joint à la liste
  inner_join(prdt_sa2013)%>%
  ###On somme par produit
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

###On calcul le ratio (autre utilisation/disponibilité intérieur)
###Unité : 1000t/1000t = 1
###On a bien un ratio
ratio_autre_di_prdt_sa2013<-
  ###On joint les deux tables ci-dessus
  inner_join(autre_prdt_sa2013, di_prdt_sa2013, by = "Produit")%>%
  ###On divise les colonnes Valeur ligne par ligne
  transmute(Produit = Produit,
            Valeur = Valeur.x/Valeur.y)%>%
  arrange(desc(Valeur))

###On calcul le poids des produits aliments pour animaux de la liste
aa_prdt_sa2013<-
  filter(produit2013, Code.Élément == 5521)%>%
  inner_join(prdt_sa2013)%>%
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

###On calcul le poids des produits pour la consomation
###humaine (nourriture) de la liste 
n_prdt_sa2013<-
  filter(produit2013, Code.Élément == 5142)%>%
  inner_join(prdt_sa2013)%>%
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

###On calcul le ratio:
###aliment pour animaux/(aliment pour animaux + nourriture)
###Unité: 1000t/1000t = 1
###On a bien un ratio
ratio_aa_naa<-
  inner_join(aa_prdt_sa2013, n_prdt_sa2013, by = "Produit")%>%
  transmute(Produit = Produit,
            Valeur = Valeur.x/(Valeur.y+Valeur.x))%>%
  arrange(desc(Valeur))

cat("Les 3 produits qui ont la plus grande valeur pour le ratio ",
    "entre la quantité \ndestinés aux autres utilisations",
    "et la disponibilité intérieure sont:",
    ###On extrait les trois plus gros ratio (autre/di)
    ratio_autre_di_prdt_sa2013$Produit%>%as.vector()%>%.[1],",",
    ratio_autre_di_prdt_sa2013$Produit%>%as.vector()%>%.[2],",",
    ratio_autre_di_prdt_sa2013$Produit%>%as.vector()%>%.[3])

cat("Les 3 produits qui ont la plus grande valeur pour le ratio ",
    "entre la quantité \ndestinés à la nourriture animale et la",
    "quantité destinée à la nourriture \n(animale + humaine) sont:",
    ###On extrait les trois plus gros ratio (aa/(aa+na))
    ratio_aa_naa$Produit%>%as.vector()%>%.[1],",",
    ratio_aa_naa$Produit%>%as.vector()%>%.[2],",",
    ratio_aa_naa$Produit%>%as.vector()%>%.[3])
```
**Question 13**
```{r 13 2013}
t_libere<-
  filter(produit2013, Code.Élément == 5521,
         is_cereal == TRUE, Code.zone == 231)%>%
  select(Valeur)%>%
  sum()*1000/10

cat(t_libere,"est Le nombre de tonnes de céréales qui pourraient",
"être libérées si les USA diminuaient leur \nproduction de produits",
"animaux de 10%")
```
**Question 14**
```{r 14 2013}
###On calcul la proportion de manioc exporté en thaïland
###On récupère la quantité de manioc exporté
manioc_exporte<-
  (filter(produit2013, Code.zone == 216, 
          Code.Élément == 5911,
          ###On multiplie par 100 pour avoir un pourcentage
          Code.Produit == 2532)$Valeur)*100/
###On la divise par quantité de manioc produit
  (filter(produit2013, Code.zone == 216, 
          Code.Élément == 5511,
          Code.Produit == 2532)$Valeur)

cat(manioc_exporte,"% du manioc produit en Thaïland est exportée")

sa_thailand<-
  ###On récupère le nombre de personne en sous nutrition en Thaïland
  ###en 2013
  (filter(sousali, Code.zone == 216, 
         Code.année == 20122014)%>%
  .$Valeur%>%
  as.vector()%>%
  ###On multiplie par 1000 pour être en millier de personne
  ###On multiplie par 100 pour être en pourcentage à la fin  
  as.numeric()*1000*100)/
  ###On divise par la population de la Thaïland
  (filter(pop2013, Code.zone == 216)$Valeur)

cat(sa_thailand,"% des Thaïlandais sont sous-alimentés")
```
<br>
<br>
*Pour l'année 2017*
<br>
<br>
**Question 6**
```{r 6 2017 di_veg, message=FALSE, warning=FALSE}
###On calcul la disponibilité intérieur mondiale par produit
di2017_veg<-
  ###On filtre la disponibilité intérieur
  filter(veg2017, Code.Élément == 5301)%>%
  ###On somme par produit
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

### On calcul la somme totale de calorie végétale du monde pour un an

### On multiplie le poid de chaque produit par leur ratio(énergie/poid)
### puis on fait la somme de tous les produits.
### Unité : (1000tonnes/an)*(kcal/kg) = 10^6kcal/an
### On multiplie le résultat par 10^6 et on est en kcal/an
somme_di2017_veg_e<-
  inner_join(di2017_veg, moyenne_ratio_e_pds, by = "Produit")%>%
  transmute(Valeur = Valeur.x*Valeur.y*10^6)%>%
  .$Valeur%>%
  sum()

cat("la disponibilité intérieure mondiale exprimée en kcal uniquement",
    "pour les produits végétaux est de",somme_di2017_veg_e,"kcal")
```
<br>
<br>
**Question 7**
```{r 7 2017 humain nourrit, message=FALSE, warning=FALSE}
### On calcul la somme totale de calorie végétale du monde pour un an

### On multiplie le poid de chaque produit par leur ratio(énergie/poid)
### puis on fait la somme de tous les produits.
### Unité : (1000tonnes/an)*(kcal/kg) = 10^6kcal/an
### On multiplie le résultat par 10^6 et on est en kcal/an
somme_di2017_veg_e<-
  inner_join(di2017_veg, moyenne_ratio_e_pds, by = "Produit")%>%
  transmute(Valeur = Valeur.x*Valeur.y*10^6)%>%
  .$Valeur%>%
  sum()
  
cat("si toute la disponibilité intérieure mondiale de produits",
    "végétaux était utilisée \npour de la nourriture en 2017",
    "cela représenterai",somme_di2017_veg_e,"kcal") 

### On calcul la somme totale de protéine végétale du monde pour un an

### On multiplie le poid de chaque produit par leur pourcentage de 
### protéine puis on fait la somme de tous les produits.
### Unité : (1000tonnes/an)*(1/100) = 10^4kg/an
### On multiplie le résultat par 10^4 et on est en kg
somme_di2017_veg_p<-
  inner_join(di2017_veg, moyenne_ratio_p_pds, by = "Produit")%>%
  transmute(Valeur = Valeur.x*Valeur.y*10^4)%>%
  .$Valeur%>%
  sum()

cat("si toute la disponibilité intérieure mondiale de produits",
    "végétaux était utilisée \npour de la nourriture en 2017",
    "cela représenterai",somme_di2017_veg_p,"kg de protéine")  

### Un humain à besoin de 2300 kcal par jour pour survivre (FAO)
cal_min_per_jour<-2300
### Un humain à besoin de 0.05 kg de protéine par jour pour survivre
proteine_min_per_jour<-0.05

### On calcule le pourcentage de population mondiale que l'on peut
### nourir en terme de calorie avec seulement les produits végétaux
### Unité : (kcal/ans)/(personnes*(kcal/jour/personne)) = 1/365
### On multiplie par 365 puis par 100 et on est en pourcentage
humain1_nourrit_e<-
  (somme_di2017_veg_e/(365*pop2017_t*cal_min_per_jour))*100

cat("si toute la disponibilité intérieure mondiale de produits",
    "végétaux était utilisée \npour de la nourriture on pourrait",
    "nourir",humain1_nourrit_e,"% de la population mondiale",
    "\nen terme de calories")

### On calcule le pourcentage de population mondiale que l'on peut
### nourir en terme de protéine avec seulement les produits végétaux
### Unité : (kg/ans)/(personnes*(kg/jour/personne)) = 1/365
### On multiplie par 365 puis par 100 et on est en pourcentage
humain1_nourrit_p<-
  (somme_di2017_veg_p/
  (365*pop2017_t*proteine_min_per_jour))*100

cat("si toute la disponibilité intérieure mondiale de produits",
    "végétaux était utilisée \npour de la nourriture on pourrait",
    "nourir",humain1_nourrit_p,"% de la population mondiale",
    "\nen terme de protéines")
```
<br>
<br>
**Question 8**
```{r 8 2017 somme_n_pe_aa_veg, message=FALSE, warning=FALSE}
n_pe_aa_veg2017_e<-
  ###On ne garde que nourriture, perte et aliment pour animaux en 2017
  ###(en filtrant par les codes élément 5142, 5123 et 5521)
  filter(veg2017, Code.Élément %in% c(5142, 5123, 5521))%>%
  ###On somme par produit et zone
  group_by(Produit, Zone)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###On multiplie chaque produit de chaque pays par son ratio
  ###Unité = 1000t*kcal/kg = 10^6kcal
  ###On multiplie par 10^6 pour être en kcal
  table_faop(ratio_e_pds, ., "Produit","Zone", coefficient = 10^6)%>%
  ###On somme tous les kcal de chaques produits de chaques pays
  select(Valeur)%>%
  sum()

cat("En 2017 si toute la disponibilité alimentaire en produits",
    "végétaux la nourriture végétale \ndestinée aux animaux et les",
    "pertes de produits végétaux étaient utilisés pour de la", 
    "nourriture \ncela représenterai",n_pe_aa_veg2017_e,
    "kcal de nourriture")

n_pe_aa_veg2017_p<-
  filter(veg2017, Code.Élément %in% c(5142, 5123, 5521))%>%
  filter(Symbole != "A")%>%
  group_by(Produit, Zone)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###Unité = 1000t*1/100 = 10t =10000kg
  ###On multiplie par 10000 pour être en kg
  table_faop(ratio_p_pds, ., "Produit","Zone", coefficient = 10^4)%>%
  select(Valeur)%>%
  sum()

cat("En 2017 si toute la disponibilité alimentaire en produits",
    "végétaux la nourriture végétale \ndestinée aux animaux et les",
    "pertes de produits végétaux étaient utilisés pour de la", 
    "nourriture \ncela représenterai",n_pe_aa_veg2017_p,
    "kg de protéine")

humain2_nourrit_e<-
  ###On divise le totale de kcal des produits végétaux 
  ###(nourriture, aliment pour animaux et perte)
  ###par le besoin mondiale en kcal pour un an
  ###On multiplie par cent pour obtenir un pourcentage
  (n_pe_aa_veg2017_e/(365*pop2017_t*cal_min_per_jour))*100

cat("En 2017 si toute la disponibilité alimentaire en produits",
    "végétaux la nourriture végétale \ndestinée aux animaux et les",
    "pertes de produits végétaux étaient utilisés pour de la", 
    "nourriture \non pourrait nourrir",humain2_nourrit_e,
    "% de la population mondiale en terme de calories")

humain2_nourrit_p<-
  ###On divise le totale de g de protéine des produits végétaux 
  ###(nourriture, aliment pour animaux et perte)
  ###par le besoin mondiale en protéine pour un an
  ###On multiplie par cent pour obtenir un pourcentage
  (n_pe_aa_veg2017_p/(365*pop2017_t*proteine_min_per_jour))*100

cat("En 2017 si toute la disponibilité alimentaire en produits",
    "végétaux la nourriture végétale \ndestinée aux animaux et les",
    "pertes de produits végétaux étaient utilisés pour de la", 
    "nourriture \non pourrait nourrir",humain2_nourrit_p,
    "% de la population mondiale en terme de protéine")
```
<br>
<br>
**Question 9**
```{r 9 2017 somme_da, message=FALSE, warning=FALSE}
###On calcul la somme des disponibilitées alimentaire de chaque
###pays en kcal

somme_da2017_e<-
  ###On ne garde que la nourriture en 207
  ###(en filtrant par le codes élément 5142)
  filter(produit2017, Code.Élément == 5142)%>%
  ###On somme par produit et zone
  group_by(Produit, Zone)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###On multiplie chaque produit de chaque pays par son ratio
  ###Unité = 1000t*kcal/kg = 10^6kcal
  ###On multiplie par 10^6 pour être en kcal
  table_faop(ratio_e_pds, ., "Produit","Zone", coefficient = 10^6)%>%
  ###On somme tous les kcal de chaques produits de chaques pays
  select(Valeur)%>%
  sum()

cat("En 2017 la disponibilité alimentaire mondiale en terme de", 
    "\ncalories est de",somme_da2017_e,"kcal")
    
somme_da2017_p<-
  filter(produit2017, Code.Élément == 5142)%>%
  group_by(Produit, Zone)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###Unité = 1000t*1/100 = 10t =10000kg
  ###On multiplie par 10000 pour être en kg
  table_faop(ratio_p_pds, ., "Produit","Zone", coefficient = 10^4)%>%
  select(Valeur)%>%
  sum()


cat("En 2017 la disponibilité alimentaire mondiale en terme de", 
    "\nprotéine est de",somme_da2017_e,"kg")

humain3_nourrit_e<-
  (somme_da2017_e/(365*pop2017_t*cal_min_per_jour))*100

cat(humain3_nourrit_e,"% de la population mondiale pourraient être", 
    "nourris avec la \ndisponibilité alimentaire mondiale en",
    "terme de calories en 2017")

humain3_nourrit_p<-
  (somme_da2017_p/(365*pop2017_t*proteine_min_per_jour))*100

cat(humain3_nourrit_p,"% de la population mondiale pourraient être", 
    "nourris avec la \ndisponibilité alimentaire mondiale en",
    "terme de protéines en 2017")
```
<br>
<br>
**Question 10**
```{r 10 2017 sous alimentées, message=FALSE, warning=FALSE}
nbre_sa2017 <-
  ###On filtre les personne sous alimenté par pays en 2017 
  ###(On filtre les pays dont on ne connait
  ### pas les chiffre et les pays qui compte moins de 
  ### 100000 personnes sous alimenté)
  filter(sousali, Symbole == "F",
         Valeur != "<0.1",
         Code.année == 20162018)%>%
  ###On sélectionne la colonne "Valeur"
  select(Valeur)%>%
  ###On la transforme en vecteur numerique pour 
  ###pouvoir sommer ses éléments
  unlist()%>%
  as.vector()%>%
  as.numeric()%>%
  ###On somme toutes les valeurs pour obtenir le totale de personne
  ### sous alimenté
  sum()*10^6
  
cat((nbre_sa2017/pop2017_t)*100,
"% de la population mondiale est considérée",
"comme étant en sous-nutrition en 2017 d'après la FAO")  
```
<br>
<br>
**Question 11**
<br>
<br>
```{r 11 2017 cereal, message=FALSE, warning=FALSE}
###On ajoute une colonne is_cereal à la table produit2017
produit2017<-iscereal(produit2017)

###On affiche les différents produit de type céréale
filter(produit2017, is_cereal == TRUE)%>%
  group_by(Code.Produit, Produit)%>%
  summarise()%>%
  datatable()

###On calcul le poid totale des céréales pour la consomation
###humaine et animale
cereal2017_n_aa <-
  ###On filtre les éléments nourriture et aliment
  ###pour animaux et on filtre les produits de type céréale
  filter(produit2017, Code.Élément %in% c(5142, 5521),
         is_cereal == TRUE)%>%
  ###On somme le tout
  select(Valeur)%>%
  sum()

###On calcul le poids des céréales pour animaux              
cereal2017_aa <- 
  filter(produit2017, Code.Élément == 5521,
         is_cereal == TRUE)%>%
  select(Valeur)%>%
  sum()

###On fait le quotient aa/(n + aa) et on affiche la réponse
###On multiplie par cent pour être en pourcentage
cat(cereal2017_aa*100/cereal2017_n_aa,"% des céréales destinées à",
    "l'alimentation est réservé aux animaux")
```
<br>
<br>
**Question 12**
```{r 12 2017 sous nutrition, message=FALSE, warning=FALSE}
###On veut sélectionner les 15 produits les plus exportés
###par les pays possédant des personnes en sous-nutrition
prdt_sa2017<-
  ###On filtre les pays dans lesquels la FAO recense des   
  ###personnes en sous-nutrition en 2017
  filter(sousali, Symbole == "F", Code.année == 20162018)%>%
  select(Zone)%>%
  ###On joint avec les exportations en 2017
  inner_join(filter(produit2017, Code.Élément == 5911))%>%
  ###On somme par produit
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###On range du produit le plus exporté au moins exporté
  arrange(desc(Valeur))%>%
  ###On conserve les 15 premiers
  slice(1:15)%>%
  ###On ne garde que la colonnes produit
  select(Produit)

###La liste des 15 produits les plus exportés par les pays possédant
###des personnes en sous-nutrition en 2017 (prdt_sa2017)
datatable(prdt_sa2017)

###Somme des 200 importations les plus importantes de la liste des
###15 produits ci-dessus par produit
importation_prdt_sa2017<-
  ###On filtre les importations en 2017 
  filter(produit2017, Code.Élément == 5611)%>%
  ###On joint avec les 15 produit ci-dessus
  inner_join(prdt_sa2017)%>%
  ###On range de la plus grande à la moins grande
  arrange(desc(Valeur))%>%
  ###On ne garde que les 200 plus grandes importations
  slice(1:200)%>%
  ###On somme par produit
  group_by(Produit, Unité)%>%
  summarise(Valeur = sum(Valeur))%>%
  ###On range dans l'ordre décroissant
  arrange(desc(Valeur))

datatable(importation_prdt_sa2017)

###On calcul le poids des autres utilisations des produits de la liste
autre_prdt_sa2017<-
  ###On filtre les autres utilisations
  filter(produit2017, Code.Élément == 5154)%>%
  ###On joint à la liste
  inner_join(prdt_sa2017)%>%
  ###On somme par produit
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

###On calcul la disponibilité intérieur des 15 produits de la liste
di_prdt_sa2017<-
  ###On filtre la disponibilité intérieur
  filter(produit2017, Code.Élément == 5301)%>%
  ###On joint à la liste
  inner_join(prdt_sa2017)%>%
  ###On somme par produit
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

###On calcul le ratio (autre utilisation/disponibilité intérieur)
###Unité : 1000t/1000t = 1
###On a bien un ratio
ratio_autre_di_prdt_sa2017<-
  ###On joint les deux tables ci-dessus
  inner_join(autre_prdt_sa2017, di_prdt_sa2017, by = "Produit")%>%
  ###On divise les colonnes Valeur ligne par ligne
  transmute(Produit = Produit,
            Valeur = Valeur.x/Valeur.y)%>%
  arrange(desc(Valeur))

###On calcul le poids des produits aliments pour animaux de la liste
aa_prdt_sa2017<-
  filter(produit2017, Code.Élément == 5521)%>%
  inner_join(prdt_sa2017)%>%
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

###On calcul le poids des produits pour la consomation
###humaine (nourriture) de la liste 
n_prdt_sa2017<-
  filter(produit2017, Code.Élément == 5142)%>%
  inner_join(prdt_sa2017)%>%
  group_by(Produit)%>%
  summarise(Valeur = sum(Valeur))

###On calcul le ratio:
###aliment pour animaux/(aliment pour animaux + nourriture)
###Unité: 1000t/1000t = 1
###On a bien un ratio
ratio_aa_naa<-
  inner_join(aa_prdt_sa2017, n_prdt_sa2017, by = "Produit")%>%
  transmute(Produit = Produit,
            Valeur = Valeur.x/(Valeur.y+Valeur.x))%>%
  arrange(desc(Valeur))

cat("Les 3 produits qui ont la plus grande valeur pour le ratio ",
    "entre la quantité \ndestinés aux autres utilisations",
    "et la disponibilité intérieure sont:",
    ###On extrait les trois plus gros ratio (autre/di)
    ratio_autre_di_prdt_sa2017$Produit%>%as.vector()%>%.[1],",",
    ratio_autre_di_prdt_sa2017$Produit%>%as.vector()%>%.[2],",",
    ratio_autre_di_prdt_sa2017$Produit%>%as.vector()%>%.[3])

cat("Les 3 produits qui ont la plus grande valeur pour le ratio ",
    "entre la quantité \ndestinés à la nourriture animale et la",
    "quantité destinée à la nourriture \n(animale + humaine) sont:",
    ###On extrait les trois plus gros ratio (aa/(aa+na))
    ratio_aa_naa$Produit%>%as.vector()%>%.[1],",",
    ratio_aa_naa$Produit%>%as.vector()%>%.[2],",",
    ratio_aa_naa$Produit%>%as.vector()%>%.[3])
```
**Question 13**
```{r 13 2017}
t_libere<-
  filter(produit2017, Code.Élément == 5521,
         is_cereal == TRUE, Code.zone == 231)%>%
  select(Valeur)%>%
  sum()*1000/10

cat(t_libere,"est Le nombre de tonnes de céréales qui pourraient",
"être libérées si les USA diminuaient leur \nproduction de produits",
"animaux de 10%")
```
**Question 14**
```{r 14 2017}
###On calcul la proportion de manioc exporté en thaïland
###On récupère la quantité de manioc exporté
manioc_exporte<-
  (filter(produit2017, Code.zone == 216, 
          Code.Élément == 5911,
          ###On multiplie par 100 pour avoir un pourcentage
          Code.Produit == 2532)$Valeur)*100/
###On la divise par quantité de manioc produit
  (filter(produit2017, Code.zone == 216, 
          Code.Élément == 5511,
          Code.Produit == 2532)$Valeur)

cat(manioc_exporte,"% du manioc produit en Thaïland est exportée")

sa_thailand<-
  ###On récupère le nombre de personne en sous nutrition en Thaïland
  ###en 2017
  (filter(sousali, Code.zone == 216, 
         Code.année == 20162018)%>%
  .$Valeur%>%
  as.vector()%>%
  ###On multiplie par 1000 pour être en millier de personne
  ###On multiplie par 100 pour être en pourcentage à la fin  
  as.numeric()*1000*100)/
  ###On divise par la population de la Thaïland
  (filter(pop2017, Code.zone == 216)$Valeur)

cat(sa_thailand,"% des Thaïlandais sont sous-alimentés")
```


